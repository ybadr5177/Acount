@using System.Globalization
@using Microsoft.AspNetCore.Mvc.Localization

@inject IViewLocalizer localizer
@{
    var isRTL = CultureInfo.CurrentCulture.Name.StartsWith("ar");
}
@model ProductPageViewModel
@{
    ViewData["Title"] = "Index";
}

<style>
    /* Your existing CSS for counter-container and counter-input */
    /* Your existing CSS for counter-container and counter-input */
    .counter-container {
        display: flex;
        align-items: center;
        justify-content: center;
        font-family: Arial, sans-serif;
    }

    .counter-input {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        border: 2px solid #ccc;
        text-align: center;
        font-size: 18px;
        -moz-appearance: textfield;
    }

        .counter-input::-webkit-outer-spin-button,
        .counter-input::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

    /* âœ… Ø§Ù„Ø£ÙƒÙˆØ§Ø¯ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© Ø§Ù„ØªÙŠ ØªØµÙ†Ø¹ Ø´ÙƒÙ„ Ø§Ù„Ø£Ù‚ÙˆØ§Ø³ */
    .counter-button {
        position: relative; /* Ù…Ù‡Ù… Ù„Ø¶Ø¨Ø· Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø£Ù‚ÙˆØ§Ø³ */
        background-color: transparent; /* Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø®Ù„ÙÙŠØ© Ø§Ù„Ø£ØµÙ„ÙŠØ© Ù„Ù„Ø²Ø± */
        color: black; /* Ù„ÙˆÙ† Ø¹Ù„Ø§Ù…Ø© Ø§Ù„Ø²Ø§Ø¦Ø¯ ÙˆØ§Ù„Ù†Ø§Ù‚Øµ */
        border: none;
        cursor: pointer;
        font-size: 24px;
        width: 25px; /* ØªÙ… ØªØµØºÙŠØ± Ø§Ù„Ø­Ø¬Ù… */
        height: 40px; /* ØªÙ… ØªØµØºÙŠØ± Ø§Ù„Ø­Ø¬Ù… */
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 0;
        line-height: 1;
        overflow: hidden; /* Ù„Ù…Ù†Ø¹ Ø¸Ù‡ÙˆØ± Ø£ÙŠ Ø¬Ø²Ø¡ Ø²Ø§Ø¦Ø¯ Ù…Ù† Ø§Ù„Ù‚ÙˆØ³ */
    }

        .counter-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: black;
            z-index: -1; /* Ù„Ø¬Ø¹Ù„ Ø§Ù„Ù‚ÙˆØ³ ÙŠØ¸Ù‡Ø± Ø®Ù„Ù Ø§Ù„Ù†Øµ */
        }

        .counter-button.minus::before {
            border-radius: 0 50% 50% 0 / 0 100% 100% 0; /* Ø´ÙƒÙ„ Ø§Ù„Ù‚ÙˆØ³ Ø§Ù„Ø£ÙŠØ³Ø± */
        }

        .counter-button.plus::before {
            border-radius: 50% 0 0 50% / 100% 0 0 100%; /* Ø´ÙƒÙ„ Ø§Ù„Ù‚ÙˆØ³ Ø§Ù„Ø£ÙŠÙ…Ù† */
        }

    /*  /* Ø§Ù„Ù‚Ù„Ø¨ Ø§Ù„ÙØ§Ø¶ÙŠ */
    .js-addwish-b2 .icon-heart1 {
        display: block;
    }

    /* Ø§Ù„Ù‚Ù„Ø¨ Ø§Ù„Ù…Ù„ÙŠØ§Ù† */
    .js-addwish-b2 .icon-heart2 {
        display: none;
    }

    /* Ù„Ù…Ø§ Ø§Ù„Ø²Ø± ÙŠØ¨Ù‚Ù‰ Active â†’ Ù†Ø®ÙÙŠ Ø§Ù„ÙØ§Ø¶ÙŠ ÙˆÙ†Ø¸Ù‡Ø± Ø§Ù„Ù…Ù„ÙŠØ§Ù† */
    .js-addwish-b2.active .icon-heart1 {
        display: none;
    }

    .js-addwish-b2.active .icon-heart2 {
        display: block;
    }

    */
</style>


<section class="section-slide">
    <div class="wrap-slick1">
        <div class="slick1">
            @* <div class="item-slick1" style="background-image: url(images/slide-01.jpg);">
                <div class="container h-full">
                    <div class="flex-col-l-m h-full p-t-100 p-b-30 respon5">
                        <div class="layer-slick1 animated visible-false" data-appear="fadeInDown" data-delay="0">
                            <span class="ltext-101 cl2 respon2">
                                Women Collection 2018
                            </span>
                        </div>

                        <div class="layer-slick1 animated visible-false" data-appear="fadeInUp" data-delay="800">
                            <h2 class="ltext-201 cl2 p-t-19 p-b-43 respon1">
                                NEW SEASON
                            </h2>
                        </div>

                        <div class="layer-slick1 animated visible-false" data-appear="zoomIn" data-delay="1600">
                            <a href="product.html" class="flex-c-m stext-101 cl0 size-101 bg1 bor1 hov-btn1 p-lr-15 trans-04">
                                Shop Now
                            </a>
                        </div>
                    </div>
                </div>
            </div>

            <div class="item-slick1" style="background-image: url(images/slide-02.jpg);">
                <div class="container h-full">
                    <div class="flex-col-l-m h-full p-t-100 p-b-30 respon5">
                        <div class="layer-slick1 animated visible-false" data-appear="rollIn" data-delay="0">
                            <span class="ltext-101 cl2 respon2">
                                Men New-Season
                            </span>
                        </div>

                        <div class="layer-slick1 animated visible-false" data-appear="lightSpeedIn" data-delay="800">
                            <h2 class="ltext-201 cl2 p-t-19 p-b-43 respon1">
                                Jackets & Coats
                            </h2>
                        </div>

                        <div class="layer-slick1 animated visible-false" data-appear="slideInUp" data-delay="1600">
                            <a href="product.html" class="flex-c-m stext-101 cl0 size-101 bg1 bor1 hov-btn1 p-lr-15 trans-04">
                                Shop Now
                            </a>
                        </div>
                    </div>
                </div>
            </div>

            <div class="item-slick1" style="background-image: url( https://images.unsplash.com/photo-1506744038136-46273834b3fb?auto=format&fit=crop&w=800&q=80
);">
                <div class="container h-full">
                    <div class="flex-col-l-m h-full p-t-100 p-b-30 respon5">
                        <div class="layer-slick1 animated visible-false" data-appear="rotateInDownLeft" data-delay="0">
                            <span class="ltext-101 cl2 respon2">
                                Men Collection 2018
                            </span>
                        </div>

                        <div class="layer-slick1 animated visible-false" data-appear="rotateInUpRight" data-delay="800">
                            <h2 class="ltext-201 cl2 p-t-19 p-b-43 respon1">
                                New arrivals
                            </h2>
                        </div>

                        <div class="layer-slick1 animated visible-false" data-appear="rotateIn" data-delay="1600">
                            <a href="product.html" class="flex-c-m stext-101 cl0 size-101 bg1 bor1 hov-btn1 p-lr-15 trans-04">
                                Shop Now
                            </a>
                        </div>
                    </div>
                </div>
            </div> *@

            @await Component.InvokeAsync("GetAllProduct")
        </div>
    </div>
</section>

@await Component.InvokeAsync("GetAllCategry")



<!-- Product -->
<section class="bg0 p-t-23 p-b-140">
    <div class="container">
        <div class="p-b-10">
            <h3 class="ltext-103 cl5">
                @localizer["ProductOverview"]
            </h3>
        </div>
        <div class="flex-w flex-sb-m p-b-52">
            <div class="flex-w flex-l-m filter-tope-group m-tb-10">
                @* <a asp-action="Index"
                   asp-controller="Mastar"
                   class="stext-106 cl6 hov1 bor3 trans-04 m-r-32 m-tb-5 @(Model.Filter.CategoryId == null ? "how-active1" : "")">
                    All Products
                </a> *@
                <a href="#"
                   data-ajax="true"
                   data-query=""
                   class="stext-106 cl6 hov1 bor3 trans-04 m-r-32 m-tb-5 @(Model.Filter.CategoryId == null ? "how-active1" : "")">
                    All Products
                </a>
                @foreach (var item in Model.Categories)
                {
                    @*  <a asp-action="Index"
                       asp-controller="Mastar"
                       asp-route-CategoryId="@item.Id"
                       class="stext-106 cl6 hov1 bor3 trans-04 m-r-32 m-tb-5  @(Model.Filter.CategoryId == item.Id ? "how-active1" : "")">
                        @item.Name_EN
                    </a> *@
                    <a href="#"
                       data-ajax="true"
                       data-query="CategoryId=@item.Id"
                       class="stext-106 cl6 hov1 bor3 trans-04 m-r-32 m-tb-5 @(Model.Filter.CategoryId == item.Id ? "how-active1" : "")">
                        @item.Name_EN
                    </a>
                }


                @* <button class="stext-106 cl6 hov1 bor3 trans-04 m-r-32 m-tb-5" data-filter=".men">
            Men
        </button>

        <button class="stext-106 cl6 hov1 bor3 trans-04 m-r-32 m-tb-5" data-filter=".bag">
            Bag
        </button>

        <button class="stext-106 cl6 hov1 bor3 trans-04 m-r-32 m-tb-5" data-filter=".shoes">
            Shoes
        </button>

        <button class="stext-106 cl6 hov1 bor3 trans-04 m-r-32 m-tb-5" data-filter=".watches">
            Watches
        </button> *@
            </div>

            <div class="flex-w flex-c-m m-tb-10">
                <div class="flex-c-m stext-106 cl6 size-104 bor4 pointer hov-btn3 trans-04 m-r-8 m-tb-4 js-show-filter">
                    <i class="icon-filter cl2 m-r-6 fs-15 trans-04 zmdi zmdi-filter-list"></i>
                    <i class="icon-close-filter cl2 m-r-6 fs-15 trans-04 zmdi zmdi-close dis-none"></i>
                    @localizer["Filter"]
                </div>

                <div class="flex-c-m stext-106 cl6 size-105 bor4 pointer hov-btn3 trans-04 m-tb-4 js-show-search">
                    <i class="icon-search cl2 m-r-6 fs-15 trans-04 zmdi zmdi-search"></i>
                    <i class="icon-close-search cl2 m-r-6 fs-15 trans-04 zmdi zmdi-close dis-none"></i>
                    @localizer["search"]
                </div>
            </div>

            <!-- Search product -->
            <div id="searchDiv" class="w-full">
                <div class="dis-none panel-search w-full p-t-10 p-b-15">
                    <div class="bor8 dis-flex p-l-15">
                        <button id="searchButton" class="size-113 flex-c-m fs-16 cl2 hov-cl1 trans-04">
                            <i class="zmdi zmdi-search"></i>
                        </button>
                        <input id="searchInput" class="mtext-107 cl2 size-114 plh2 p-r-15"
                               type="text"
                               name="Search"
                               value="@Model.Filter.Search"
                               placeholder="Search">
                    </div>
                </div>
            </div>

            <!-- Filter -->
            <div class="dis-none panel-filter w-full p-t-10">
                <div class="wrap-filter flex-w bg6 w-full p-lr-40 p-t-27 p-lr-15-sm">
                    <div class="filter-col1 p-r-15 p-b-27">
                        <div class="mtext-102 cl2 p-b-15">
                            Sort By
                        </div>
                        <ul>
        <li class="p-b-6">
            <a href="#"
               data-ajax="true"
               data-query="?SortBy=PriceAsc"
                                   class="filter-link stext-106 trans-04 @(Model.Filter.Sort == "PriceAsc" ? "filter-link-active" : "")">
                Price: Low to High
            </a>
        </li>
        <li class="p-b-6">
            <a href="#"
               data-ajax="true"
               data-query="?SortBy=PriceDesc"
               class="filter-link stext-106 trans-04 @(Model.Filter.Sort == "PriceDesc" ? "filter-link-active" : "")">
                Price: High to Low
            </a>
        </li>
    </ul>
                        @* <ul>
                            <li class="p-b-6">
                                <a href="#" class="filter-link stext-106 trans-04">
                                    Default
                                </a>
                            </li>

                            <li class="p-b-6">
                                <a href="#" class="filter-link stext-106 trans-04">
                                    Popularity
                                </a>
                            </li>

                            <li class="p-b-6">
                                <a href="#" class="filter-link stext-106 trans-04">
                                    Average rating
                                </a>
                            </li>

                            <li class="p-b-6">
                                <a href="#" class="filter-link stext-106 trans-04 filter-link-active">
                                    Newness
                                </a>
                            </li>

                            <li class="p-b-6">
                                <a href="#" class="filter-link stext-106 trans-04">
                                    Price: Low to High
                                </a>
                            </li>

                            <li class="p-b-6">
                                <a href="#" class="filter-link stext-106 trans-04">
                                    Price: High to Low
                                </a>
                            </li>
                        </ul> *@
                    </div>

                   @*  <div class="filter-col2 p-r-15 p-b-27">
                        <div class="mtext-102 cl2 p-b-15">
                            Price
                        </div>

                        <ul>
                            <li class="p-b-6">
                                <a href="#"
                                   data-ajax="true"
                                   data-query="?SortBy=PriceAsc"
                                   class="filter-link stext-106 trans-04 @(Model.Filter.SortBy == "PriceAsc" ? "filter-link-active" : "")">
                                    Price: Low to High
                                </a>
                            </li>
                            <li class="p-b-6">
                                <a href="#"
                                   data-ajax="true"
                                   data-query="?SortBy=PriceDesc"
                                   class="filter-link stext-106 trans-04 @(Model.Filter.SortBy == "PriceDesc" ? "filter-link-active" : "")">
                                    Price: High to Low
                                </a>
                            </li>
                        </ul>
                    </div> *@
                </div>
            </div>
        </div>
        @Html.Partial("ProductsPartial", Model.Products)

      
    </div>
</section>

@section Scripts {
    <!--Ø§Ù„Ø§Ø³ÙƒØ±Ø¨Øª Ø§Ù„Ø®Ø§Øµ Ø¨Ù„ Ù…Ù†ØªØ¬Ø§Øª-->
    <!-- jQuery (Ù„Ø§Ø²Ù… ÙŠÙŠØ¬ÙŠ Ù‚Ø¨Ù„ Ø£ÙŠ Ø­Ø§Ø¬Ø©) -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <!-- Ø§Ø§Ù„Ø®Ø§Øµ Ø¨Ø§ Ø§Ù„Ø¨Ø­Ø« ÙˆØ§Ø§Ù„ÙÙ„ØªØ±Ù‡ -->
    <script>
        // helper: ÙŠØ¨Ù†ÙŠ ÙƒÙˆÙŠØ±ÙŠ Ø³ØªØ±Ù†Ø¬ Ù…Ù† Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¨Ø­Ø« ÙÙ‚Ø·
        function toQueryString(value) {
            if (!value) return "";
            return `?Search=${encodeURIComponent(value)}`;
        }

        // Ø¯Ø§Ù„Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø¹Ø¨Ø± Ajax
        async function loadProducts(qs) {
            const url = '/Mastar/ProductsPartial' + (qs || '');
            const container = document.getElementById('productsContainer');
            container.innerHTML = '<div class="text-center w-100 p-5">Loading...</div>';

            try {
                const res = await fetch(url, { headers: { 'X-Requested-With': 'XMLHttpRequest' } });
                const html = await res.text();
                container.innerHTML = html;
                initProductEvents();
                const indexUrl = '/Mastar/Index' + (qs || '');
                window.history.pushState({}, '', indexUrl);
            } catch (error) {
                console.error('Error loading products:', error);
                container.innerHTML = '<div class="text-center w-100 p-5">Failed to load products. Please try again later.</div>';
            }
        }

        // ... (Ø¨Ù‚ÙŠØ© Ø§Ù„Ø¯ÙˆØ§Ù„ Ø§Ù„Ø£Ø®Ø±Ù‰) ...

        document.addEventListener('DOMContentLoaded', function () {
            // ... (ÙƒÙˆØ¯ wireCarouselStopLink) ...

            // âœ… Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ Ù‡Ù†Ø§: ÙƒÙˆØ¯ ÙÙ„ØªØ±Ø© Ø§Ù„ÙƒØ§ØªÙŠØ¬ÙˆØ±ÙŠ ÙˆØ§Ù„ÙØ±Ø²
            // Ù‡Ø°Ù‡ Ø§Ù„Ø¯Ø§Ù„Ø© Ø§Ù„Ø¢Ù† ØªØªØ¹Ø§Ù…Ù„ Ù…Ø¹ ÙƒÙ„ Ø§Ù„ÙÙ„Ø§ØªØ±
            function handleFilterClick(e) {
                e.preventDefault();

                const currentQs = window.location.search;
                const urlParams = new URLSearchParams(currentQs);
                const newParam = this.getAttribute('data-query');

                if (newParam) {
                    // ÙÙ„ØªØ± Ø¹Ø§Ø¯ÙŠ (Ù…Ø«Ù„Ø§Ù‹ØŒ categoryId=1 Ø£Ùˆ SortBy=PriceAsc)
                    const [key, value] = newParam.split('=');
                    urlParams.set(key, value);
                } else {
                    // "All Products" (Ø¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø· Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙÙ„Ø§ØªØ±)
                    urlParams.delete('CategoryId');
                    urlParams.delete('SortBy');
                    urlParams.delete('Search');
                }

                // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø£ÙƒØªÙŠÙ
                document.querySelectorAll('[data-ajax="true"]').forEach(a => a.classList.remove('how-active1', 'filter-link-active'));
                this.classList.add('how-active1', 'filter-link-active');

                loadProducts('?' + urlParams.toString());
            }

            // Ø¥Ø±ÙØ§Ù‚ Ø§Ù„Ø­Ø¯Ø« Ù„Ù„ÙƒØ§ØªÙŠØ¬ÙˆØ±ÙŠ
            document.querySelectorAll('.filter-tope-group a[data-ajax="true"]').forEach(a => {
                a.addEventListener('click', handleFilterClick);
            });

            // Ø¥Ø±ÙØ§Ù‚ Ø§Ù„Ø­Ø¯Ø« Ù„Ù„ÙØ±Ø²
            document.querySelectorAll('.panel-filter ul a[data-ajax="true"]').forEach(a => {
                a.addEventListener('click', handleFilterClick);
            });

            // âœ… ÙƒÙˆØ¯ Ø§Ù„Ø¨Ø­Ø« (AJAX) - ØªÙ… ØªØ¹Ø¯ÙŠÙ„Ù‡ Ù„Ø¯Ù…Ø¬ Ø§Ù„ÙÙ„Ø§ØªØ± Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­
            const searchInput = document.getElementById('searchInput');
            const searchButton = document.getElementById('searchButton');

            if (searchInput && searchButton) {
                function handleSearch(e) {
                    e.preventDefault();
                    const value = searchInput.value;
                    const currentQs = window.location.search;
                    const urlParams = new URLSearchParams(currentQs);

                    if (value) {
                        urlParams.set('Search', value);
                    } else {
                        urlParams.delete('Search');
                    }

                    loadProducts('?' + urlParams.toString());
                }

                searchButton.addEventListener('click', handleSearch);
                searchInput.addEventListener('keypress', function (e) {
                    if (e.key === 'Enter') {
                        handleSearch(e);
                    }
                });
            }
        });
    </script>
    <script>
        // Ø¯Ø§Ù„Ø© Ù„ØªÙ‡ÙŠØ¦Ø© Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
        function initProductEvents() {
            // âœ… Ø§Ù„Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ø®Ø§ØµØ© Ø¨ØªØºÙŠÙŠØ± Ø§Ù„Ù…Ù‚Ø§Ø³
            $(document).off('change', '.sizeSelect').on('change', '.sizeSelect', function () {
                console.log("ğŸŸ¡ ØªÙ… ØªØºÙŠÙŠØ± Ø§Ù„Ù…Ù‚Ø§Ø³");

                var id = $(this).data('product-id');
                var selectedOption = $(this).find('option:selected');
                var price = selectedOption.data("price");
                var discount = selectedOption.data("discount");

                console.log({ id, price, discount });

                var priceElement = $('#sizePrice-' + id);
                var discountElement = $('#discountPrice-' + id);

                if (discount && discount < price) {
                    priceElement.text(discount + " $").removeClass("text-success").addClass("text-success");
                    discountElement.text(price + " $").show();
                } else {
                    priceElement.text(price + " $").removeClass("text-success");
                    discountElement.hide();
                }
            });

            // âœ… ÙƒÙˆØ¯ Ø§Ù„Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù…Ø­Ø¯Ø«
            $('.counter-container').each(function() {
                const counterContainer = $(this);
                const minusButton = counterContainer.find('.minus');
                const plusButton = counterContainer.find('.plus');
                const counterInput = counterContainer.find('.counter-input');

                minusButton.off('click').on('click', (e) => {
                    e.preventDefault();
                    let value = parseInt(counterInput.val());
                    if (value > 1) {
                        counterInput.val(value - 1);
                    }
                });

                plusButton.off('click').on('click', (e) => {
                    e.preventDefault();
                    let value = parseInt(counterInput.val());
                    counterInput.val(value + 1);
                });
            });

           // âœ… ØªØ¹Ø¯ÙŠÙ„ Ø²Ø± Ø§Ù„Ø³Ù„Ø© Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ø¯Ø«Ø©
            $(document).off('click', '.btn-add-to-cart').on('click', '.btn-add-to-cart', function (e) {
                e.preventDefault();

                var productId = $(this).data('product-id');
                var productContainer = $(this).closest('.block2-txt').closest('.block2-txt').find('.block2-txt-child1');


                // âœ… Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„ÙƒÙ…ÙŠØ© Ù…Ù† Ø­Ù‚Ù„ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„

                var counterInput = $(this).closest('.block2-txt').find('.counter-input');
                  var qty = counterInput.val();

                // âœ… Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù‚Ø§Ø³ Ø§Ù„Ù…Ø­Ø¯Ø¯
                var sizeSelect = $('#sizeSelect-' + productId);
                var selectedSizeId = sizeSelect.val();
                var selectedOption = sizeSelect.find('option:selected');

                // âœ… Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ù…Ù†Ø§Ø³Ø¨ (Ø§Ù„Ù…Ù†ØªØ¬ Ø£Ùˆ Ø§Ù„Ù…Ù‚Ø§Ø³)
                var priceElement = $('#sizePrice-' + productId);
                var priceText = priceElement.text().replace(' $', '').trim();
                var price = parseFloat(priceText);

                console.log("ğŸ›’ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø±Ø³Ù„Ø©:", {
                    productId: productId,
                    quantity: qty,
                    sizeId: selectedSizeId,
                    price: price
                });



                // âœ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ø¨Ø± Ajax
                $.ajax({
                    url: '@Url.Action("AddItem", "Basket")',
                    type: 'POST',
                    data: {
                        Id: productId,
                        Quantity: qty,
                        SizeId: selectedSizeId,
                        Price: price
                    },
                    success: function (res) {
                        if (res.success) {
                            alert("âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬ Ø¥Ù„Ù‰ Ø§Ù„Ø³Ù„Ø© Ø¨Ù†Ø¬Ø§Ø­!");
                        } else {
                            alert("The operation is successful âœ…" );
                        }
                    },
                    error: function (err) {
                        alert("âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬ Ø¥Ù„Ù‰ Ø§Ù„Ø³Ù„Ø©!");
                        console.error(err);
                    }
                });
            });
        }

        // Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ø§Ù„Ø¯Ø§Ù„Ø© Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
        $(document).ready(function () {
            initProductEvents();
        });
    </script>

    <!--Favorite Script-->
    <script>
        document.addEventListener("DOMContentLoaded", async () => {
            const buttons = document.querySelectorAll(".js-addwish-b2");

            for (let btn of buttons) {
                const productId = btn.dataset.productid;

                // âœ… ØªØ´ÙŠÙƒ Ø£ÙˆÙ„ Ù…Ø§ Ø§Ù„ØµÙØ­Ø© ØªÙØªØ­
                try {
                    const checkRes = await fetch(`/Favorite/IsFavorite?productId=${productId}`);
                    if (checkRes.status === 200) {
                        const result = await checkRes.json();
                        if (result.isFav === true) {
                            btn.classList.add("active"); // ğŸ”¹ ÙŠØ¸Ù‡Ø± Ø§Ù„Ù‚Ù„Ø¨ Ø§Ù„Ù…Ù„ÙŠØ§Ù†
                        } else {
                            btn.classList.remove("active"); // ğŸ”¹ ÙŠØ¸Ù‡Ø± Ø§Ù„Ù‚Ù„Ø¨ Ø§Ù„ÙØ§Ø¶ÙŠ
                        }
                    }
                } catch (err) {
                    console.warn("User not logged in, skip fav check.");
                }

                // âœ… Ù„Ù…Ø§ ÙŠØ¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ù‚Ù„Ø¨
                btn.addEventListener("click", async (e) => {
                    e.preventDefault();

                    if (btn.classList.contains("active")) {
                        // Ù„Ùˆ Ù…ÙˆØ¬ÙˆØ¯ â†’ Ø§Ø­Ø°Ù
                        const res = await fetch(`/Favorite/RemoveFavorite?productId=${productId}`, { method: "POST" });
                        if (res.status === 401) {
                            window.location.href = "/Account/Login";
                            return;
                        }
                        btn.classList.remove("active"); // ğŸ”¹ ÙŠØ±Ø¬Ù‘Ø¹ Ø§Ù„Ù‚Ù„Ø¨ ÙØ§Ø¶ÙŠ

                    } else {
                        // Ù„Ùˆ Ù…Ø´ Ù…ÙˆØ¬ÙˆØ¯ â†’ Ø£Ø¶Ù
                        const res = await fetch(`/Favorite/AddFavorite?productId=${productId}`, { method: "POST" });
                        if (res.status === 401) {
                            window.location.href = "/Account/Login";
                            return;
                        }
                        btn.classList.add("active"); // ğŸ”¹ ÙŠØ®Ù„ÙŠ Ø§Ù„Ù‚Ù„Ø¨ Ù…Ù„ÙŠØ§Ù†
                    }
                });
            }
        });
    </script>

    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script><!-- Select2 JS -->
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <!--///////////////////////////////////////////////////////////////////////////////////////////////-->
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            document.querySelectorAll(".stop-link").forEach(btn => {
                btn.addEventListener("click", function (event) {
                    event.stopPropagation(); // ÙŠÙ…Ù†Ø¹ Ø§Ù„Ù„ÙŠÙ†Ùƒ Ø§Ù„ÙƒØ¨ÙŠØ± Ù…Ù† Ø§Ù„ÙØªØ­
                });
            });
        });
    </script>

    <script>
        // Ø¯Ø§Ù„Ø© Ù„Ø¥Ø¸Ù‡Ø§Ø±/Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†Ø³Ø¯Ù„Ø©
        function toggleDropdown() {
            const dropdown = document.getElementById('userDropdown');
            dropdown.classList.toggle('show');
        }

        function toggleDropdown2() {
            const dropdown = document.getElementById('userDropdown2');
            dropdown.classList.toggle('show');
        }

        // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„Ù…Ù†Ø³Ø¯Ù„Ø© Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø± Ø®Ø§Ø±Ø¬Ù‡Ø§
        window.onclick = function(event) {
            if (!event.target.matches('.dropdown-toggle')) {
                const dropdowns = document.getElementsByClassName("dropdown-menu");
                for (let i = 0; i < dropdowns.length; i++) {
                    const openDropdown = dropdowns[i];
                    if (openDropdown.classList.contains('show')) {
                        openDropdown.classList.remove('show');
                    }
                }
            }
        }
    </script>
}

